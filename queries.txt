
ALTER SESSION SET NLS_DATE_FORMAT = 'DD-MON-YYYY' NLS_DATE_LANGUAGE='english'; 
select sysdate from dual; 

--a-- (all the records from 1 table)
SELECT * FROM AUTHOR;
SELECT * FROM BOOKS;
SELECT * FROM COPY;
SELECT * FROM USERS;
SELECT * FROM LOANS;

--b-- (in reverse alphabetical order)
SELECT AUTHOR_ID,A_LASTNAME,A_FIRSTNAME FROM AUTHOR ORDER BY A_LASTNAME DESC;
SELECT ISBN,TITLE,GENRE FROM BOOKS ORDER BY TITLE DESC;
SELECT USER_ID, US_LASTNAME,US_FIRSTNAME FROM USERS ORDER BY US_FIRSTNAME DESC;

--c--
SELECT A_LASTNAME SURNAME, A_FIRSTNAME FIRSTNAME, GENRE FROM AUTHOR A JOIN BOOKS B ON A.AUTHOR_ID=B.AUTHOR_ID WHERE GENRE='Novel';
SELECT A_LASTNAME SURNAME, A_FIRSTNAME FIRSTNAME, GENRE FROM AUTHOR A JOIN BOOKS B ON A.AUTHOR_ID=B.AUTHOR_ID WHERE GENRE='Horror';

SELECT A_LASTNAME SURNAME, A_FIRSTNAME AS FIRSTNAME FROM AUTHOR WHERE A_FIRSTNAME LIKE 'J%SON';

SELECT AUTHOR_ID, A_LASTNAME SURNAME, A_FIRSTNAME FIRSTNAME, COUNTRY FROM AUTHOR WHERE COUNTRY!='GREECE';

SELECT TITLE, LOAN_DATE FROM BOOKS B JOIN COPY C ON B.ISBN=C.ISBN JOIN LOANS L ON C.COPY_ID=L.COPY_ID WHERE LOAN_DATE LIKE '%OCT%' OR LOAN_DATE LIKE '%JAN%';

--d--
SELECT TITLE, GENRE, DATE_OF_PURCHASE FROM BOOKS B JOIN COPY C ON B.ISBN=C.ISBN;
SELECT TITLE, LOAN_DATE FROM BOOKS B JOIN COPY C ON B.ISBN=C.ISBN JOIN LOANS L ON C.COPY_ID=L.COPY_ID WHERE LOAN_DATE LIKE '%DEC%';
SELECT US_LASTNAME SURNAME, C.COPY_ID, TITLE FROM USERS U JOIN LOANS L ON U.USER_ID=L.USER_ID JOIN COPY C ON C.COPY_ID=L.COPY_ID JOIN BOOKS B ON B.ISBN=C.ISBN WHERE TITLE='THE HAUNTING OF HILL HOUSE';

--e--

--1--
SELECT A_LASTNAME LASTNAME,A_FIRSTNAME AS FIRSTNAME FROM AUTHOR WHERE A_LASTNAME LIKE 'K%G';

--2--
SELECT GENRE, COUNT(*) FROM BOOKS GROUP BY GENRE;

--3--
SELECT * FROM (SELECT TITLE,COUNT(TITLE) AS LOANED_TIMES FROM COPY C JOIN LOANS L ON C.COPY_ID=L.COPY_ID JOIN BOOKS B ON B.ISBN=C.ISBN GROUP BY TITLE ORDER BY COUNT(TITLE) DESC) WHERE ROWNUM=1;

--4--
SELECT DISTINCT A_LASTNAME SURNAME,A_FIRSTNAME FIRSTNAME,TITLE FROM AUTHOR JOIN BOOKS ON AUTHOR.AUTHOR_ID=BOOKS.AUTHOR_ID;

--5--
SELECT COUNT(*) FROM BOOKS WHERE TO_CHAR(DATE_PUBLISHED,'DD-MON-YYYY') LIKE '%1981';

--6--
SELECT A_LASTNAME SURNAME, A_FIRSTNAME FIRSTNAME, GENRE  FROM AUTHOR A JOIN BOOKS B ON A.AUTHOR_ID=B.AUTHOR_ID WHERE GENRE = 'Romance' OR  GENRE ='Scientific';

--7--
SELECT TITLE,LOAN_DATE FROM BOOKS B JOIN COPY C ON B.ISBN=C.ISBN JOIN LOANS L ON C.COPY_ID=L.COPY_ID WHERE LOAN_DATE LIKE '%OCT%';

--8--
SELECT * FROM (SELECT DISTINCT COUNT(*) AS ALIVE FROM AUTHOR WHERE DATE_OF_DEATH IS NULL),
(SELECT DISTINCT COUNT(*) AS DEAD FROM AUTHOR WHERE DATE_OF_DEATH IS NOT NULL);

--9--- 
SELECT * FROM (SELECT A_LASTNAME AS SURNAME,A_FIRSTNAME AS FIRSTNAME,MONTHS_BETWEEN(DATE_OF_DEATH,DATE_OF_BIRTH) FROM AUTHOR WHERE DATE_OF_DEATH IS NOT NULL ORDER BY MONTHS_BETWEEN(DATE_OF_DEATH,DATE_OF_BIRTH) DESC) WHERE ROWNUM=1;

--10--
SELECT * FROM (SELECT A_LASTNAME AS SURNAME,A_FIRSTNAME AS FIRSTNAME, MONTHS_BETWEEN(SYSDATE,DATE_OF_BIRTH) FROM AUTHOR WHERE DATE_OF_DEATH IS NULL ORDER BY MONTHS_BETWEEN(SYSDATE,DATE_OF_BIRTH) DESC) WHERE ROWNUM=1;

--11-- 
 SELECT * FROM (SELECT A.AUTHOR_ID,A.A_LASTNAME,COUNT(*) AS NUMBER_OF_BOOKS FROM AUTHOR A JOIN BOOKS B ON A.AUTHOR_ID=B.AUTHOR_ID GROUP BY A.AUTHOR_ID,A.A_LASTNAME ORDER BY COUNT(*) DESC);

--12--
SELECT AUTHOR_ID,A_FIRSTNAME AS FIRSTNAME,A_LASTNAME AS LASTNAME FROM AUTHOR WHERE AUTHOR_ID NOT IN (SELECT DISTINCT A.AUTHOR_ID FROM AUTHOR A JOIN BOOKS B ON A.AUTHOR_ID=B.AUTHOR_ID JOIN COPY C ON B.ISBN=C.ISBN JOIN LOANS L ON L.COPY_ID=L.COPY_ID JOIN USERS U ON U.USER_ID=L.USER_ID);

--13--
SELECT TITLE  FROM BOOKS WHERE TITLE NOT IN (SELECT DISTINCT TITLE FROM BOOKS B JOIN COPY C ON C.ISBN=B.ISBN JOIN LOANS L ON L.COPY_ID=C.COPY_ID JOIN USERS U ON U.USER_ID=L.USER_ID);

--14--
SELECT TO_CHAR(DATE_PUBLISHED,'YYYY') YEAR, SUM(PRICE) TOTAL_PRICE FROM AUTHOR A JOIN BOOKS B ON A.AUTHOR_ID=B.AUTHOR_ID GROUP BY TO_CHAR(DATE_PUBLISHED,'YYYY');

--15--
SELECT GENDER, SUM(PRICE) TOTAL_PRICE FROM AUTHOR A JOIN BOOKS B ON A.AUTHOR_ID=B.AUTHOR_ID GROUP BY GENDER;

--16--
SELECT * FROM (SELECT TITLE,COUNT(*) AS "NUMBER OF BOOKS" FROM(SELECT TITLE FROM BOOKS B JOIN COPY C ON B.ISBN=C.ISBN) GROUP BY TITLE ORDER BY COUNT(*) DESC) WHERE ROWNUM=1;

--17--
SELECT AUTHOR_ID,A_LASTNAME AS SURNAME, A_FIRSTNAME AS FIRSTNAME,COUNTRY FROM AUTHOR WHERE COUNTRY!='ENGLAND';

--18--
SELECT U.USER_ID,US_LASTNAME AS SURNAME,C.COPY_ID,TITLE FROM USERS U JOIN LOANS L ON U.USER_ID=L.USER_ID JOIN COPY C ON C.COPY_ID=L.COPY_ID JOIN BOOKS B ON B.ISBN=C.ISBN WHERE TITLE='BLUES FOR A BLACK CAT';

--19--
SELECT B.AUTHOR_ID,AVG(PAGES) FROM AUTHOR A JOIN BOOKS B ON A.AUTHOR_ID=B.AUTHOR_ID GROUP BY B.AUTHOR_ID ORDER BY AVG(PAGES) DESC;

--20--
SELECT * FROM(SELECT A.AUTHOR_ID,A_LASTNAME AS SURNAME, A_FIRSTNAME AS FIRSTNAME,COUNTRY,PRICE FROM AUTHOR A JOIN BOOKS B ON A.AUTHOR_ID=B.AUTHOR_ID WHERE COUNTRY='ENGLAND' ORDER BY PRICE DESC) WHERE ROWNUM=1;


----------BONUS----------

--1---
SELECT * FROM (SELECT U.USER_ID,US_LASTNAME AS LASTNAME, SUM(PAGES) AS NUMBER_OF_PAGES FROM USERS U JOIN LOANS L ON U.USER_ID=L.USER_ID JOIN COPY C ON C.COPY_ID=L.COPY_ID JOIN BOOKS B ON B.ISBN=C.ISBN GROUP BY U.USER_ID,US_LASTNAME ORDER BY SUM(PAGES) DESC) WHERE ROWNUM=1;

--2--
SELECT * FROM (SELECT U.USER_ID,TITLE,US_LASTNAME AS LASTNAME,COUNT(TITLE) AS NUMBER_OF_LOANS FROM USERS U JOIN LOANS L ON U.USER_ID=L.USER_ID JOIN COPY C ON C.COPY_ID=L.COPY_ID JOIN BOOKS B ON B.ISBN=C.ISBN GROUP BY U.USER_ID,TITLE,US_LASTNAME ORDER BY COUNT(TITLE) DESC) WHERE ROWNUM=1;

--3--
SELECT GENDER,COUNT(TITLE) AS NUMBER_OF_BOOKS FROM USERS U JOIN LOANS L ON U.USER_ID=L.USER_ID JOIN COPY C ON C.COPY_ID=L.COPY_ID JOIN BOOKS B ON B.ISBN=C.ISBN GROUP BY GENDER;

--4--
SELECT CONCAT(SUBSTR(US_FIRSTNAME,1,3),SUBSTR(US_LASTNAME,1,4)) USERNAME FROM USERS;

--5--
SELECT LOAN_DATE,LOAN_DATE+14 AS RETURN_DATE FROM LOANS;

--6--
SELECT * FROM(SELECT A.AUTHOR_ID,A_LASTNAME AS LASTNAME,A_FIRSTNAME AS FIRSTNAME,SUM(PAGES) AS NUMBER_OF_PAGES FROM BOOKS B JOIN AUTHOR A ON B.AUTHOR_ID=A.AUTHOR_ID GROUP BY A.AUTHOR_ID,A_LASTNAME,A_FIRSTNAME ORDER BY SUM(PAGES) DESC) WHERE ROWNUM=1;

--7-- 
SELECT * FROM(SELECT GENRE, COUNT(GENRE) AS NUMBER_OF_BOOKS FROM BOOKS GROUP BY GENRE ORDER BY COUNT(GENRE) DESC) WHERE ROWNUM=1;

--8--
SELECT * FROM(SELECT EXTRACT (YEAR FROM LOAN_DATE) YEAR,COUNT(LOAN_DATE) AS TOTAL_LOANS FROM LOANS GROUP BY EXTRACT(YEAR FROM LOAN_DATE) ORDER BY COUNT(LOAN_DATE) DESC) WHERE ROWNUM=1;

--9--
SELECT COUNT(*) AS NUMBER_OF_GREEK_BOOKS FROM BOOKS B JOIN AUTHOR A ON B.AUTHOR_ID=A.AUTHOR_ID WHERE COUNTRY='GREECE';

--10--
SELECT TITLE FROM BOOKS WHERE TITLE LIKE '%MISERY%';